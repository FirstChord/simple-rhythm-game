<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duration Scoring Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .perfect { background: #d4edda; color: #155724; }
        .good { background: #fff3cd; color: #856404; }
        .miss { background: #f8d7da; color: #721c24; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Duration Scoring Test</h1>
    
    <div class="test-container">
        <h3>Test Results:</h3>
        <div id="testResults"></div>
    </div>
    
    <script src="rhythmEngine.js"></script>
    <script>
        // Test duration scoring functionality
        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '';
            
            console.log('=== Duration Scoring Tests ===');
            
            // Create rhythm engine
            const engine = new RhythmEngine(120); // 120 BPM = 500ms per beat
            
            // Simple test pattern: quarter note, quarter note
            const testPattern = [
                { type: 'quarter', rest: false },
                { type: 'quarter', rest: false }
            ];
            
            engine.loadPattern(testPattern);
            engine.start();
            
            // Test 1: Just tapping (no hold) - should work as before
            engine.holdPeriods = [
                { down: 0, up: null },    // Quick tap at start
                { down: 500, up: null }   // Quick tap at second note
            ];
            
            let testResults = engine.scorePattern();
            addResult('Test 1 - Quick taps only', testResults, 'Should score based on timing only');
            
            // Test 2: Good duration holds
            engine.holdPeriods = [
                { down: 0, up: 450 },     // Hold for ~450ms (expected ~500ms)
                { down: 500, up: 950 }    // Hold for ~450ms 
            ];
            
            testResults = engine.scorePattern();
            addResult('Test 2 - Good duration holds', testResults, 'Should score well with correct hold durations');
            
            // Test 3: Too short holds
            engine.holdPeriods = [
                { down: 0, up: 100 },     // Hold for only 100ms (too short)
                { down: 500, up: 600 }    // Hold for only 100ms (too short)
            ];
            
            testResults = engine.scorePattern();
            addResult('Test 3 - Too short holds', testResults, 'Should downgrade scores for short holds');
            
            // Test 4: Too long holds
            engine.holdPeriods = [
                { down: 0, up: 1000 },    // Hold for 1000ms (too long)
                { down: 500, up: 1500 }   // Hold for 1000ms (too long)
            ];
            
            testResults = engine.scorePattern();
            addResult('Test 4 - Too long holds', testResults, 'Should downgrade scores for long holds');
            
            // Test 5: Perfect timing with perfect duration
            engine.holdPeriods = [
                { down: 0, up: 500 },     // Perfect duration
                { down: 500, up: 1000 }   // Perfect duration
            ];
            
            testResults = engine.scorePattern();
            addResult('Test 5 - Perfect timing + duration', testResults, 'Should get perfect scores');
            
            console.log('=== Tests Complete ===');
        }
        
        function addResult(testName, results, description) {
            const div = document.createElement('div');
            div.className = 'result';
            
            let html = `<h4>${testName}</h4><p><em>${description}</em></p>`;
            
            results.forEach((result, i) => {
                if (result.result !== 'rest') {
                    const className = result.result;
                    const durationType = result.durationType || 'unknown';
                    const durationInfo = result.durationRatio ? 
                        `(duration ratio: ${result.durationRatio.toFixed(2)})` : '';
                    
                    html += `<div class="${className}">Note ${i+1}: ${result.result.toUpperCase()} - ${durationType} ${durationInfo}</div>`;
                }
            });
            
            html += `<pre>${JSON.stringify(results, null, 2)}</pre>`;
            div.innerHTML = html;
            
            document.getElementById('testResults').appendChild(div);
            
            console.log(testName, results);
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
